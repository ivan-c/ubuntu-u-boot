https://patchwork.ozlabs.org/patch/920785/
From 3ce3c8fb8fe7aab950f95f2455ac1885f9921bbd Mon Sep 17 00:00:00 2001
From: Klaus Goger <klaus.goger@theobroma-systems.com>
Date: Fri, 25 May 2018 23:45:05 +0200
Subject: [PATCH] rockchip: utilize CONFIG_DEFAULT_FDT_FILE
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Currently the fdtfile environment variable is set to
CONFIG_DEFAULT_DEVICE_TREE which is Ñ–nternally used as U-Boot devicetree
source. The OS can use a different filename and Kconfig gives us the
ability to select a default devicetree via CONFIG_DEFAULT_FDT_FILE.
This also gives user configuring U-Boot via menuconfig the behaviour
someone would expect.

Signed-off-by: Klaus Goger <klaus.goger@theobroma-systems.com>
---
 configs/chromebit_mickey_defconfig  | 1 +
 configs/chromebook_jerry_defconfig  | 1 +
 configs/chromebook_minnie_defconfig | 1 +
 configs/evb-px5_defconfig           | 1 +
 configs/evb-rk3036_defconfig        | 1 +
 configs/evb-rk3128_defconfig        | 1 +
 configs/evb-rk3229_defconfig        | 1 +
 configs/evb-rk3288_defconfig        | 1 +
 configs/evb-rk3328_defconfig        | 1 +
 configs/evb-rk3399_defconfig        | 1 +
 configs/evb-rv1108_defconfig        | 1 +
 configs/fennec-rk3288_defconfig     | 1 +
 configs/firefly-rk3288_defconfig    | 1 +
 configs/firefly-rk3399_defconfig    | 1 +
 configs/geekbox_defconfig           | 1 +
 configs/kylin-rk3036_defconfig      | 1 +
 configs/lion-rk3368_defconfig       | 1 +
 configs/miqi-rk3288_defconfig       | 1 +
 configs/phycore-rk3288_defconfig    | 1 +
 configs/popmetal-rk3288_defconfig   | 1 +
 configs/puma-rk3399_defconfig       | 1 +
 configs/rock2_defconfig             | 1 +
 configs/rock_defconfig              | 1 +
 configs/sheep-rk3368_defconfig      | 1 +
 configs/tinker-rk3288_defconfig     | 1 +
 configs/vyasa-rk3288_defconfig      | 1 +
 include/configs/rk3036_common.h     | 1 +
 include/configs/rk3128_common.h     | 1 +
 include/configs/rk3188_common.h     | 1 +
 include/configs/rk322x_common.h     | 1 +
 include/configs/rk3288_common.h     | 2 +-
 include/configs/rk3328_common.h     | 1 +
 include/configs/rk3368_common.h     | 1 +
 include/configs/rk3399_common.h     | 2 +-
 34 files changed, 34 insertions(+), 2 deletions(-)

Index: u-boot/configs/chromebit_mickey_defconfig
===================================================================
--- u-boot.orig/configs/chromebit_mickey_defconfig
+++ u-boot/configs/chromebit_mickey_defconfig
@@ -13,6 +13,7 @@ CONFIG_SPL_SPI_SUPPORT=y
 CONFIG_DEFAULT_DEVICE_TREE="rk3288-veyron-mickey"
 CONFIG_DEBUG_UART=y
 # CONFIG_ANDROID_BOOT_IMAGE is not set
+CONFIG_DEFAULT_FDT_FILE="rk3288-veyron-mickey.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_SPL_STACK_R=y
Index: u-boot/configs/chromebook_jerry_defconfig
===================================================================
--- u-boot.orig/configs/chromebook_jerry_defconfig
+++ u-boot/configs/chromebook_jerry_defconfig
@@ -14,6 +14,7 @@ CONFIG_DEFAULT_DEVICE_TREE="rk3288-veyro
 CONFIG_DEBUG_UART=y
 # CONFIG_ANDROID_BOOT_IMAGE is not set
 CONFIG_SILENT_CONSOLE=y
+CONFIG_DEFAULT_FDT_FILE="rk3288-veyron-jerry.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_BOARD_EARLY_INIT_F=y
Index: u-boot/configs/chromebook_minnie_defconfig
===================================================================
--- u-boot.orig/configs/chromebook_minnie_defconfig
+++ u-boot/configs/chromebook_minnie_defconfig
@@ -14,6 +14,7 @@ CONFIG_DEFAULT_DEVICE_TREE="rk3288-veyro
 CONFIG_DEBUG_UART=y
 # CONFIG_ANDROID_BOOT_IMAGE is not set
 CONFIG_SILENT_CONSOLE=y
+CONFIG_DEFAULT_FDT_FILE="rk3288-veyron-minnie.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_SPL_STACK_R=y
Index: u-boot/configs/evb-px5_defconfig
===================================================================
--- u-boot.orig/configs/evb-px5_defconfig
+++ u-boot/configs/evb-px5_defconfig
@@ -9,6 +9,7 @@ CONFIG_DEBUG_UART_CLOCK=24000000
 CONFIG_DEFAULT_DEVICE_TREE="rk3368-px5-evb"
 CONFIG_DEBUG_UART=y
 CONFIG_ANDROID_BOOT_IMAGE=y
+CONFIG_DEFAULT_FDT_FILE="rockchip/rk3368-px5-evb.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_ARCH_EARLY_INIT_R=y
Index: u-boot/configs/evb-rk3036_defconfig
===================================================================
--- u-boot.orig/configs/evb-rk3036_defconfig
+++ u-boot/configs/evb-rk3036_defconfig
@@ -13,6 +13,7 @@ CONFIG_SPL_STACK_R_ADDR=0x80000
 CONFIG_DEFAULT_DEVICE_TREE="rk3036-sdk"
 CONFIG_DEBUG_UART=y
 # CONFIG_ANDROID_BOOT_IMAGE is not set
+CONFIG_DEFAULT_FDT_FILE="rk3036-evb.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 # CONFIG_SPL_FRAMEWORK is not set
Index: u-boot/configs/evb-rk3128_defconfig
===================================================================
--- u-boot.orig/configs/evb-rk3128_defconfig
+++ u-boot/configs/evb-rk3128_defconfig
@@ -7,6 +7,7 @@ CONFIG_DEBUG_UART_CLOCK=24000000
 CONFIG_DEFAULT_DEVICE_TREE="rk3128-evb"
 CONFIG_DEBUG_UART=y
 CONFIG_FIT=y
+CONFIG_DEFAULT_FDT_FILE="rk3128-evb.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_CMD_GPT=y
Index: u-boot/configs/evb-rk3229_defconfig
===================================================================
--- u-boot.orig/configs/evb-rk3229_defconfig
+++ u-boot/configs/evb-rk3229_defconfig
@@ -12,6 +12,7 @@ CONFIG_DEBUG_UART_CLOCK=24000000
 CONFIG_SPL_STACK_R_ADDR=0x80000
 CONFIG_DEFAULT_DEVICE_TREE="rk3229-evb"
 CONFIG_DEBUG_UART=y
+CONFIG_DEFAULT_FDT_FILE="rk3229-evb.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_SPL_STACK_R=y
Index: u-boot/configs/evb-rk3288_defconfig
===================================================================
--- u-boot.orig/configs/evb-rk3288_defconfig
+++ u-boot/configs/evb-rk3288_defconfig
@@ -12,6 +12,7 @@ CONFIG_DEFAULT_DEVICE_TREE="rk3288-evb"
 CONFIG_DEBUG_UART=y
 # CONFIG_ANDROID_BOOT_IMAGE is not set
 CONFIG_SILENT_CONSOLE=y
+CONFIG_DEFAULT_FDT_FILE="rk3288-evb-rk808.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_SPL_STACK_R=y
Index: u-boot/configs/evb-rk3328_defconfig
===================================================================
--- u-boot.orig/configs/evb-rk3328_defconfig
+++ u-boot/configs/evb-rk3328_defconfig
@@ -8,6 +8,7 @@ CONFIG_DEFAULT_DEVICE_TREE="rk3328-evb"
 CONFIG_DEBUG_UART=y
 # CONFIG_ANDROID_BOOT_IMAGE is not set
 CONFIG_FIT=y
+CONFIG_DEFAULT_FDT_FILE="rockchip/rk3328-evb.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_CMD_BOOTZ=y
Index: u-boot/configs/evb-rk3399_defconfig
===================================================================
--- u-boot.orig/configs/evb-rk3399_defconfig
+++ u-boot/configs/evb-rk3399_defconfig
@@ -14,6 +14,7 @@ CONFIG_DEBUG_UART=y
 CONFIG_FIT=y
 CONFIG_SPL_LOAD_FIT=y
 CONFIG_SPL_FIT_GENERATOR="arch/arm/mach-rockchip/make_fit_atf.py"
+CONFIG_DEFAULT_FDT_FILE="rockchip/rk3399-evb.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_SPL_STACK_R=y
Index: u-boot/configs/evb-rv1108_defconfig
===================================================================
--- u-boot.orig/configs/evb-rv1108_defconfig
+++ u-boot/configs/evb-rv1108_defconfig
@@ -8,6 +8,7 @@ CONFIG_DEBUG_UART_CLOCK=24000000
 CONFIG_DEFAULT_DEVICE_TREE="rv1108-evb"
 CONFIG_DEBUG_UART=y
 # CONFIG_USE_BOOTCOMMAND is not set
+CONFIG_DEFAULT_FDT_FILE="rv1108-evb.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_RANDOM_UUID=y
Index: u-boot/configs/fennec-rk3288_defconfig
===================================================================
--- u-boot.orig/configs/fennec-rk3288_defconfig
+++ u-boot/configs/fennec-rk3288_defconfig
@@ -13,6 +13,7 @@ CONFIG_DEBUG_UART=y
 # CONFIG_ANDROID_BOOT_IMAGE is not set
 CONFIG_SILENT_CONSOLE=y
 CONFIG_CONSOLE_MUX=y
+CONFIG_DEFAULT_FDT_FILE="rk3288-fennec.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_SPL_STACK_R=y
Index: u-boot/configs/firefly-rk3288_defconfig
===================================================================
--- u-boot.orig/configs/firefly-rk3288_defconfig
+++ u-boot/configs/firefly-rk3288_defconfig
@@ -12,6 +12,7 @@ CONFIG_DEFAULT_DEVICE_TREE="rk3288-firef
 CONFIG_DEBUG_UART=y
 # CONFIG_ANDROID_BOOT_IMAGE is not set
 CONFIG_SILENT_CONSOLE=y
+CONFIG_DEFAULT_FDT_FILE="rk3288-firefly.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_SPL_STACK_R=y
Index: u-boot/configs/firefly-rk3399_defconfig
===================================================================
--- u-boot.orig/configs/firefly-rk3399_defconfig
+++ u-boot/configs/firefly-rk3399_defconfig
@@ -14,6 +14,7 @@ CONFIG_DEBUG_UART=y
 CONFIG_FIT=y
 CONFIG_SPL_LOAD_FIT=y
 CONFIG_SPL_FIT_GENERATOR="arch/arm/mach-rockchip/make_fit_atf.py"
+CONFIG_DEFAULT_FDT_FILE="rockchip/rk3399-firefly.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_SPL_STACK_R=y
Index: u-boot/configs/geekbox_defconfig
===================================================================
--- u-boot.orig/configs/geekbox_defconfig
+++ u-boot/configs/geekbox_defconfig
@@ -8,6 +8,7 @@ CONFIG_DEBUG_UART_BASE=0xFF690000
 CONFIG_DEBUG_UART_CLOCK=24000000
 CONFIG_DEFAULT_DEVICE_TREE="rk3368-geekbox"
 CONFIG_DEBUG_UART=y
+CONFIG_DEFAULT_FDT_FILE="rockchip/rk3368-geekbox.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_REGMAP=y
Index: u-boot/configs/kylin-rk3036_defconfig
===================================================================
--- u-boot.orig/configs/kylin-rk3036_defconfig
+++ u-boot/configs/kylin-rk3036_defconfig
@@ -10,6 +10,7 @@ CONFIG_SPL_SYS_MALLOC_F_LEN=0x0
 CONFIG_SPL_STACK_R_ADDR=0x80000
 CONFIG_DEFAULT_DEVICE_TREE="rk3036-sdk"
 # CONFIG_ANDROID_BOOT_IMAGE is not set
+CONFIG_DEFAULT_FDT_FILE="rk3036-kylin.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 # CONFIG_SPL_FRAMEWORK is not set
Index: u-boot/configs/lion-rk3368_defconfig
===================================================================
--- u-boot.orig/configs/lion-rk3368_defconfig
+++ u-boot/configs/lion-rk3368_defconfig
@@ -27,6 +27,7 @@ CONFIG_BOOTSTAGE=y
 CONFIG_SPL_BOOTSTAGE=y
 CONFIG_BOOTSTAGE_REPORT=y
 CONFIG_BOOTSTAGE_FDT=y
+CONFIG_DEFAULT_FDT_FILE="rockchip/rk3368-lion-haikou.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_ARCH_EARLY_INIT_R=y
Index: u-boot/configs/miqi-rk3288_defconfig
===================================================================
--- u-boot.orig/configs/miqi-rk3288_defconfig
+++ u-boot/configs/miqi-rk3288_defconfig
@@ -12,6 +12,7 @@ CONFIG_DEFAULT_DEVICE_TREE="rk3288-miqi"
 CONFIG_DEBUG_UART=y
 # CONFIG_ANDROID_BOOT_IMAGE is not set
 CONFIG_SILENT_CONSOLE=y
+CONFIG_DEFAULT_FDT_FILE="rk3288-miqi.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_SPL_STACK_R=y
Index: u-boot/configs/phycore-rk3288_defconfig
===================================================================
--- u-boot.orig/configs/phycore-rk3288_defconfig
+++ u-boot/configs/phycore-rk3288_defconfig
@@ -13,6 +13,7 @@ CONFIG_DEBUG_UART=y
 # CONFIG_ANDROID_BOOT_IMAGE is not set
 CONFIG_SILENT_CONSOLE=y
 CONFIG_CONSOLE_MUX=y
+CONFIG_DEFAULT_FDT_FILE="rk3288-phycore-rdk.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_SPL_STACK_R=y
Index: u-boot/configs/popmetal-rk3288_defconfig
===================================================================
--- u-boot.orig/configs/popmetal-rk3288_defconfig
+++ u-boot/configs/popmetal-rk3288_defconfig
@@ -13,6 +13,7 @@ CONFIG_DEBUG_UART=y
 # CONFIG_ANDROID_BOOT_IMAGE is not set
 CONFIG_SILENT_CONSOLE=y
 CONFIG_CONSOLE_MUX=y
+CONFIG_DEFAULT_FDT_FILE="rk3288-popmetal.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_SPL_STACK_R=y
Index: u-boot/configs/puma-rk3399_defconfig
===================================================================
--- u-boot.orig/configs/puma-rk3399_defconfig
+++ u-boot/configs/puma-rk3399_defconfig
@@ -18,6 +18,7 @@ CONFIG_DEBUG_UART=y
 CONFIG_FIT=y
 CONFIG_SPL_LOAD_FIT=y
 CONFIG_SPL_FIT_SOURCE="board/theobroma-systems/puma_rk3399/fit_spl_atf.its"
+CONFIG_DEFAULT_FDT_FILE="rockchip/rk3399-puma-haikou.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_SPL_BOARD_INIT=y
Index: u-boot/configs/rock2_defconfig
===================================================================
--- u-boot.orig/configs/rock2_defconfig
+++ u-boot/configs/rock2_defconfig
@@ -12,6 +12,7 @@ CONFIG_DEFAULT_DEVICE_TREE="rk3288-rock2
 CONFIG_DEBUG_UART=y
 # CONFIG_ANDROID_BOOT_IMAGE is not set
 CONFIG_SILENT_CONSOLE=y
+CONFIG_DEFAULT_FDT_FILE="rk3288-rock2-square.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_SPL_STACK_R=y
Index: u-boot/configs/rock_defconfig
===================================================================
--- u-boot.orig/configs/rock_defconfig
+++ u-boot/configs/rock_defconfig
@@ -12,6 +12,7 @@ CONFIG_DEBUG_UART_CLOCK=24000000
 CONFIG_SPL_STACK_R_ADDR=0x60080000
 CONFIG_DEFAULT_DEVICE_TREE="rk3188-radxarock"
 CONFIG_DEBUG_UART=y
+CONFIG_DEFAULT_FDT_FILE="rk3188-radxarock.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_SPL_STACK_R=y
Index: u-boot/configs/sheep-rk3368_defconfig
===================================================================
--- u-boot.orig/configs/sheep-rk3368_defconfig
+++ u-boot/configs/sheep-rk3368_defconfig
@@ -9,6 +9,7 @@ CONFIG_DEBUG_UART_CLOCK=24000000
 CONFIG_DEFAULT_DEVICE_TREE="rk3368-sheep"
 CONFIG_DEBUG_UART=y
 CONFIG_ANDROID_BOOT_IMAGE=y
+CONFIG_DEFAULT_FDT_FILE="rockchip/rk3368-sheep.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_CMD_MMC=y
Index: u-boot/configs/tinker-rk3288_defconfig
===================================================================
--- u-boot.orig/configs/tinker-rk3288_defconfig
+++ u-boot/configs/tinker-rk3288_defconfig
@@ -13,6 +13,7 @@ CONFIG_DEBUG_UART=y
 # CONFIG_ANDROID_BOOT_IMAGE is not set
 CONFIG_SILENT_CONSOLE=y
 CONFIG_CONSOLE_MUX=y
+CONFIG_DEFAULT_FDT_FILE="rk3288-tinker.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_SPL_STACK_R=y
Index: u-boot/configs/vyasa-rk3288_defconfig
===================================================================
--- u-boot.orig/configs/vyasa-rk3288_defconfig
+++ u-boot/configs/vyasa-rk3288_defconfig
@@ -12,6 +12,7 @@ CONFIG_SPL_STACK_R_ADDR=0x80000
 CONFIG_DEFAULT_DEVICE_TREE="rk3288-vyasa"
 CONFIG_DEBUG_UART=y
 CONFIG_SILENT_CONSOLE=y
+CONFIG_DEFAULT_FDT_FILE="rk3288-vyasa.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
 CONFIG_SPL_STACK_R=y
Index: u-boot/include/configs/rk3036_common.h
===================================================================
--- u-boot.orig/include/configs/rk3036_common.h
+++ u-boot/include/configs/rk3036_common.h
@@ -56,6 +56,7 @@
 /* Linux fails to load the fdt if it's loaded above 512M on a evb-rk3036 board,
  * so limit the fdt reallocation to that */
 #define CONFIG_EXTRA_ENV_SETTINGS \
+	"fdt_file=" CONFIG_DEFAULT_FDT_FILE "\0" \
 	"fdt_high=0x7fffffff\0" \
 	"partitions=" PARTS_DEFAULT \
 	ENV_MEM_LAYOUT_SETTINGS \
Index: u-boot/include/configs/rk3128_common.h
===================================================================
--- u-boot.orig/include/configs/rk3128_common.h
+++ u-boot/include/configs/rk3128_common.h
@@ -53,6 +53,7 @@
 #include <config_distro_bootcmd.h>
 #define CONFIG_EXTRA_ENV_SETTINGS \
 	ENV_MEM_LAYOUT_SETTINGS \
+	"fdt_file=" CONFIG_DEFAULT_FDT_FILE "\0" \
 	"partitions=" PARTS_DEFAULT \
 	BOOTENV
 
Index: u-boot/include/configs/rk3188_common.h
===================================================================
--- u-boot.orig/include/configs/rk3188_common.h
+++ u-boot/include/configs/rk3188_common.h
@@ -61,6 +61,7 @@
 /* Linux fails to load the fdt if it's loaded above 256M on a Rock board,
  * so limit the fdt reallocation to that */
 #define CONFIG_EXTRA_ENV_SETTINGS \
+	"fdtfile=" CONFIG_DEFAULT_FDT_FILE "\0" \
 	"fdt_high=0x6fffffff\0" \
 	"initrd_high=0x6fffffff\0" \
 	"partitions=" PARTS_DEFAULT \
Index: u-boot/include/configs/rk322x_common.h
===================================================================
--- u-boot.orig/include/configs/rk322x_common.h
+++ u-boot/include/configs/rk322x_common.h
@@ -52,6 +52,7 @@
 /* Linux fails to load the fdt if it's loaded above 512M on a evb-rk3036 board,
  * so limit the fdt reallocation to that */
 #define CONFIG_EXTRA_ENV_SETTINGS \
+	"fdtfile=" CONFIG_DEFAULT_FDT_FILE "\0" \
 	"fdt_high=0x7fffffff\0" \
 	"partitions=" PARTS_DEFAULT \
 	ENV_MEM_LAYOUT_SETTINGS \
Index: u-boot/include/configs/rk3288_common.h
===================================================================
--- u-boot.orig/include/configs/rk3288_common.h
+++ u-boot/include/configs/rk3288_common.h
@@ -69,7 +69,7 @@
 #define CONFIG_EXTRA_ENV_SETTINGS \
 	"fdt_high=0x0fffffff\0" \
 	"initrd_high=0x0fffffff\0" \
-	"fdtfile=" CONFIG_DEFAULT_DEVICE_TREE ".dtb\0" \
+	"fdtfile=" CONFIG_DEFAULT_FDT_FILE "\0" \
 	"partitions=" PARTS_DEFAULT \
 	ENV_MEM_LAYOUT_SETTINGS \
 	ROCKCHIP_DEVICE_SETTINGS \
Index: u-boot/include/configs/rk3328_common.h
===================================================================
--- u-boot.orig/include/configs/rk3328_common.h
+++ u-boot/include/configs/rk3328_common.h
@@ -46,6 +46,7 @@
 #include <config_distro_bootcmd.h>
 #define CONFIG_EXTRA_ENV_SETTINGS \
 	ENV_MEM_LAYOUT_SETTINGS \
+	"fdtfile=" CONFIG_DEFAULT_FDT_FILE "\0" \
 	"partitions=" PARTS_DEFAULT \
 	BOOTENV
 
Index: u-boot/include/configs/rk3368_common.h
===================================================================
--- u-boot.orig/include/configs/rk3368_common.h
+++ u-boot/include/configs/rk3368_common.h
@@ -46,6 +46,7 @@
 #include <config_distro_bootcmd.h>
 
 #define CONFIG_EXTRA_ENV_SETTINGS \
+	"fdtfile=" CONFIG_DEFAULT_DEVICE_TREE ".dtb\0" \
 	ENV_MEM_LAYOUT_SETTINGS	\
 	BOOTENV
 
Index: u-boot/include/configs/rk3399_common.h
===================================================================
--- u-boot.orig/include/configs/rk3399_common.h
+++ u-boot/include/configs/rk3399_common.h
@@ -55,7 +55,7 @@
 #include <config_distro_bootcmd.h>
 #define CONFIG_EXTRA_ENV_SETTINGS \
 	ENV_MEM_LAYOUT_SETTINGS \
-	"fdtfile=rockchip/" CONFIG_DEFAULT_DEVICE_TREE ".dtb\0" \
+	"fdtfile=" CONFIG_DEFAULT_FDT_FILE "\0" \
 	"partitions=" PARTS_DEFAULT \
 	BOOTENV
 
